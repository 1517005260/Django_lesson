#  *lesson 6*
接下来三次课实现用户名密码登录，并以acwing为例实现第三方授权登录。

这三次课是多人交互的基石，提供了辨别每个用户的方法

[讲义](https://www.acwing.com/file_system/file/content/whole/index/content/3294700/)

## *lesson 6.1*
0.别人的[笔记](https://www.acwing.com/solution/content/79314/)

1.本节课先初步创建账号系统
- 由于忘记之前的管理员账号密码，现在项目的根目录下`python3 manage.py createsuperuser`创建root用户
- 这次我的用户名和密码：`admin` + `Mi...`
- django有自己的数据库，直接在网页后`/admin`即可，但是这个系统比较简易（仅用户名、密码、邮箱），不能完全满足我们的需求（如上传用户头像等），所以要对这个数据库系统进行填充
- 扩充数据库：在`/game/models`里建表修改，修改指向的是管理系统里`Users`里的表

2.建立player数据库
- 先在models里建立player文件夹（方便后续分类管理），记得__init__.py
- 建立数据库，实际上就是定义用户类，详细步骤见player.py
- `table <=> class`  `数据 <=> 对象 ` 

3.注册新建的数据库，使得它能出现在管理页面里
- 修改`/game/admin.py`
- 更新数据库：在根目录下`python3 manage.py makemigrations`+`python3 manage.py migrate`
- 重启服务,现在可以在管理员页面看见player了

之后，想给基础的数据库加额外的数据可以参照以上步骤。

3.5 为了实现多端互通的功能，后端需要识别是哪个前端发送的请求，因此需要对`Game`这个js类进行修改，加上OS参数

4.实现登录功能
- 流程：`client ---request:get_info---> server ---info:username+photo---> client`或者`client ---request:get_info---> server ---info:未登录---> client`
- 有关请求类型`GET`与`POST`：二者功能基本一样，但是前者不安全，且只读。讲课为了方便全用`GET`
- 每次新增功能的代码块：`views + urls + js`前端逻辑   注意与用户相关的信息可以放到settings里
- 坑点：这里调试时候注意json格式连接的逗号，python的冒号以及web的默认platform参数为空（或者已经在js的Settings类里定义）。前两个错误回返回空白页面与502报错，后一个错误会返回`The view game.views.settings.getinfo.getinfo didn’t return an HttpResponse object. It returned None instead.`

5.js的登录逻辑
- 在`js/src`新建`settings`作为登录界面，之后详见代码
- 完整流程：`用户前端打开界面`->`进入Game主类调用Setiings构造类函数`->`Settings会调用自己的start()`->`start()里有getinfo()`->`getinfo()中有ajax向后端请求`->`后端识别platform`->`路由进入/settings/getinfo.py/getinfo()/getinfo_platform()返回结果`
- 由于后端和前端共享一个登录系统，所以只要用户是`admin`，在后端登录了在前端页面也是默认登录的。如果想退出登录，在后台`logout`后刷新前端页面即可

6.重新修改`getinfo.py`，能够判定用户是否登录，这里直接调了django的api

7.修改`Settings`和`Player`类，使得用户能渲染自己的头像
- 注意要加判断`is_me`,因为用户自己的头像是在本地前端渲染的，其他人的头像是通过后端发送的
- 注意：图片url必须完全公开，否则有概率修改不了

8.js渲染登录界面，详见`js/src/settings`以及css配置，这部分是纯前端内容（截止到写login、register函数之前）
- 注意div的class类名，登录界面和注册界面可以用一套类名，不用再额外写css了

9.接下来实现前端后端的通信
- 还是`views + urls + js`的逻辑，详细见代码
- 完整流程`用户输入我们的网址`->`空解析跳到game/urls/index.py`->`空解析调用了index的views函数`->`跳转到html文件在用户的前端渲染`->`生成js类Game`->`Game类的初始化函数调用了Settings类`->`Settings类初始化时调用getinfo函数`->`登录成功：显示菜单`//`登录未成功：显示登录界面`

### 本节课多次犯错：python的冒号漏加