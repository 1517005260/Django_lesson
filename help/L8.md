# *lesson 8*
实现聊天系统

别人的[笔记](https://www.acwing.com/activity/content/code/content/2348754/)

## 一些优化
1.我们会发现，之前的键盘监听都是对`$(window)`的，这会导致如果是acapp端的话，你摁下按键后所有的视窗都会有反应。这在之前不是问题，但是这节课我们要实现聊天框，就比较有问题了，所以要把监听对象改成地图
- 注意canvas标签要加上`tabindex=0`才能聚焦监听键盘事件（输入），并且要在start中`focus()`启动监听

## 前端
实现 enter 打开聊天框 esc关闭  <br>
一共两块部分：聊天框+历史记录，这两个部分互相独立  （比如你没说话，但是别人说话了，那么历史记录就要弹出来）

1.js中的`return true/false`
### `return false`的用途：

- **阻止默认行为**：使用`return false;`来阻止浏览器执行与事件关联的默认动作。例如：
  - 在绑定到`contextmenu`事件的函数中，返回`false`阻止了浏览器显示右键菜单。
    - 当技能（如“fireball”或“blink”）的冷却时间不足时，阻止进一步处理鼠标左键点击或相应的键盘按键（`Q`键激活火球技能，`F`键激活闪现技能）的默认行为。
      - 在处理`keydown`事件时，对于Enter键（聊天框的打开）和ESC键（聊天框的关闭），在多人模式下返回`false`防止了按键的默认行为。

### `return true`的用途：

- **允许默认行为**：
  - 在`mousedown`事件处理中，如果游戏状态不是“fighting”，则允许默认行为发生，这可能意味着不阻止游戏地图上的其他鼠标点击行为。
    - 在处理键盘事件时，如果技能的冷却时间超过了阈值，对于`Q`键和`F`键的处理返回`true`，允许键盘事件的默认行为（这里的默认行为并不重要，因为代码的主要目的是设置当前技能）。

2.实现聊天框的js代码和css样式

3.实现发送信息功能
- 其中，历史记录的显示默认为3s。并且每次都要记录显示历史记录的函数id，防止玩家快速打开和关闭聊天功能，而历史记录仅持续第一次的3s便消失
- 实现历史记录显示玩家对话功能（username+text）


## 后端
实现通信功能——让你发的话大家都能看见

方法同上节课
